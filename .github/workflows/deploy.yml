name: Deploy FastAPI to Railway

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    container: ghcr.io/railwayapp/cli:latest  # Usa la imagen oficial de Railway CLI
    env:
      SVC_ID: ${{ secrets.RAILWAY_SERVICE_ID }}  # Usa secret en lugar de valor hardcodeado
      RAILWAY_TOKEN: ${{ secrets.RAILWAY_TOKEN }}
    
    steps:
      - name: 🛒 Checkout code
        uses: actions/checkout@v4  # Versión actualizada

      - name: 🐍 Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.10'  # Versión compatible con FastAPI

      - name: 📦 Install dependencies
        run: pip install -r requirements.txt

      - name: 🚀 Deploy to Railway
        run: railway up --service=${{ env.SVC_ID }} --detach

      - name: 🔍 Verify deployment
        run: railway logs --service=${{ env.SVC_ID }} --tail 5
